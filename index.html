<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>血糖換算 · HbA1c 估算 · 安心值</title>
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#2563eb">
<link rel="icon" href="icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<link rel="apple-touch-icon" href="icon-192.png">
<style>
  :root { --radius: 14px; }
  body { font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,"Noto Sans CJK TC","PingFang TC","Helvetica Neue",Arial,sans-serif;
         margin: 0; background: #f7fbff; color:#0a2540; }
  header { padding: 18px 16px; text-align:center; font-weight:700; background: #e8f2ff; }
  .wrap { max-width: 560px; margin: 0 auto; padding: 16px; }
  .card { background: #fff; border-radius: var(--radius); box-shadow: 0 6px 24px rgba(10,37,64,.08);
          padding: 16px; margin-bottom: 14px; }
  .row { display:flex; gap:12px; align-items:center; }
  .col { flex:1; }
  label { display:block; font-size:14px; margin-bottom:8px; }
  input[type="number"], input[type="text"] { width: 100%; font-size: 20px; padding: 12px 14px; border-radius: 12px; border:1px solid #c5d9ee; outline: none; }
  input[type="number"]:focus, input[type="text"]:focus { border-color:#3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,.15); }
  .unit { font-size: 13px; color:#3b6ea5; margin-top:6px; }
  .btns { display:flex; gap:10px; margin-top: 10px; }
  button { flex:1; padding: 12px 14px; border:none; border-radius: 12px; font-weight:600; cursor:pointer; }
  .primary { background:#2563eb; color:#fff; }
  .ghost { background:#eef5ff; color:#0a2540; }
  .hint { font-size:13px; color:#315d8a; margin: 8px 0 0; }
  .badge { display:inline-block; padding:6px 10px; border-radius:999px; font-weight:700; font-size:13px; }
  .ok { background:#e6f7ec; color:#0f6b34; }
  .warn { background:#fff7e6; color:#8a5a00; }
  .danger { background:#fde7e7; color:#a31212; }
  .fieldset { display:flex; gap:14px; flex-wrap:wrap; font-size:13px; color:#315d8a; margin: 6px 0 0; }
  footer { text-align:center; color:#5b7da6; font-size:12px; padding: 16px; }
  .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
  .pill { padding: 6px 10px; border-radius: 999px; font-weight: 700; font-size: 13px; display:inline-block; }
  .pill.blue{ background:#e8f2ff; color:#1e40af; }
</style>
</head>
<body>
<header>血糖換算 · HbA1c 估算 · 安心值</header>
<div class="wrap">
  <!-- Converter, Quick ref, HbA1c, Range tips ... (省略，保持不變) -->

  <!-- New: 三方整合 · 安心值 -->
  <div class="card">
    <div class="row"><div class="col">
      <label>三方整合 · 安心值</label>
      <div class="unit">輸入你同一時間點的讀數，系統會自動計算「安心值」（取中間判讀）。</div>
    </div></div>

    <div class="row" style="margin-top:10px">
      <div class="col">
        <label for="bgmSeries">BGM 指尖血（可填 1~3 個，用逗號分隔）</label>
        <input id="bgmSeries" type="text" inputmode="numeric" placeholder="例如：101, 116" class="mono">
        <div class="unit">系統會自動取平均</div>
      </div>
    </div>

    <div class="row" style="margin-top:10px">
      <div class="col">
        <label for="sannuoMmol">三諾（mmol/L）</label>
        <input id="sannuoMmol" type="number" inputmode="decimal" placeholder="例如 5.0" step="0.1">
        <div class="unit">會自動換算為 mg/dL</div>
      </div>
      <div class="col">
        <label for="abbottMg">亞培（mg/dL）</label>
        <input id="abbottMg" type="number" inputmode="decimal" placeholder="例如 113" step="0.1">
      </div>
    </div>

    <div class="row" style="margin-top:12px">
      <div class="col">
        <div id="安心結果" class="unit">
          <span class="pill blue">BGM 平均：—</span>
          <span class="pill blue" id="sannuoEcho">三諾換算：—</span>
          <span class="pill blue" id="abbottEcho">亞培：—</span>
        </div>
        <div id="安心值Out" class="hint" style="margin-top:8px"><span class="badge ok">安心值：—</span></div>
      </div>
    </div>
    <div class="btns">
      <button class="primary" id="copy安心">複製安心值</button>
      <button class="ghost" id="clear安心">清除</button>
    </div>
    <div class="unit">規則：有 BGM → (BGM 平均 + 三諾mg/dL + 亞培) ÷ 3；無 BGM → (三諾mg/dL + 亞培) ÷ 2</div>
  </div>

  <!-- Chart module -->
  <div class="card">
    <label>安心值 vs 單機數字</label>
    <canvas id="glucoseChart" height="200"></canvas>
    <div class="unit">灰色：BGM 平均｜綠色：三諾｜藍色：亞培｜粉紅色：安心值</div>
    <div class="btns" style="margin-top:10px">
      <button class="primary" id="exportPNG">匯出圖表 PNG</button>
      <button class="ghost" id="exportCSV">匯出數據 CSV</button>
    </div>
  </div>
</div>
<footer>提示：加入主畫面後，可離線使用；結果僅供參考，不取代醫療判讀。</footer>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// 修正變數名稱
const abbottInput = document.getElementById('abbottMg');

// 其餘 const 宣告保持不變，只把 abbottMg 改為 abbottInput
// 在 calc安心值() 裡，使用 parseFloat(abbottInput.value)
// 在事件監聽器裡，改為 abbottInput.addEventListener('input', calc安心值);
</script>
</body>
</html>
